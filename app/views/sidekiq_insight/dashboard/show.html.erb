<div class="container py-4">

  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">
      Samples for <%= params[:job] %>
    </h2>

    <% if @leak %>
      <span class="badge bg-danger fs-6 px-3 py-2 shadow-sm">Memory Leak Detected</span>
    <% else %>
      <span class="badge bg-success fs-6 px-3 py-2 shadow-sm">No Leak</span>
    <% end %>
  </div>

  <!-- Charts Section -->
  <div class="row g-4">

    <!-- WALL TIME -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white">Wall Time (ms)</div>
        <div class="card-body">
          <%= line_chart @samples.reverse.map { |s| [s[:started_at], s[:wall_ms].to_f] },
              library: { maintainAspectRatio: false } %>
        </div>
      </div>
    </div>

    <!-- CPU -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-info text-white">CPU (ms)</div>
        <div class="card-body">
          <%= line_chart @samples.reverse.map { |s| [s[:started_at], s[:cpu_ms].to_f] } %>
        </div>
      </div>
    </div>

    <!-- RSS MEMORY -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-success text-white">RSS Delta (KB)</div>
        <div class="card-body">
          <%= line_chart @samples.reverse.map { |s| [s[:started_at], s[:rss_kb].to_f] } %>
        </div>
      </div>
    </div>

  </div>

  <!-- Raw Data Table -->
  <div class="card mt-5 shadow-sm">
    <div class="card-header bg-dark text-white">
      Sample Details
    </div>

    <div class="card-body p-0">
      <table class="table table-striped table-bordered mb-0">
        <thead class="table-light">
          <tr>
            <th>Started</th>
            <th>Wall (ms)</th>
            <th>CPU (ms)</th>
            <th>RSS (KB)</th>
            <th>Args</th>
          </tr>
        </thead>

        <tbody>
          <% @samples.each do |s| %>
            <tr>
              <td class="text-nowrap"><%= s[:started_at] %></td>
              <td><%= s[:wall_ms] %></td>
              <td><%= s[:cpu_ms] %></td>
              <td><%= s[:rss_kb] %></td>
              <td style="max-width:300px;">
                <pre class="small bg-light p-2 rounded"><%= JSON.pretty_generate(s[:args]) rescue s[:args] %></pre>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

</div>
